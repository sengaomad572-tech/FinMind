<style>
    /* Yangi element: Kategoriyalar uchun */
    .expense-details {
        display: none; /* Faqat tugma bosilganda ochiladi */
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px dashed #334155;
    }
    .category-row {
        display: flex; justify-content: space-between; margin-bottom: 8px;
    }
    .category-row input { width: 45% !important; padding: 8px !important; font-size: 12px; }
    .toggle-details {
        font-size: 11px; color: var(--accent); cursor: pointer; text-decoration: underline; margin-bottom: 10px; display: block;
    }
</style>

<div class="input-section">
    <label>Moliyaviy ko'rsatkichlar</label>
    <div class="stats">
        <div class="input-group">
            <label>Jami Daromad ($)</label>
            <input type="number" id="inRev" value="12000">
        </div>
        <div class="input-group">
            <label>Zaxira (Cash) ($)</label>
            <input type="number" id="inCash" value="38000">
        </div>
    </div>

    <span class="toggle-details" onclick="document.getElementById('expDetails').style.display='block'">+ Xarajatlar tafsilotini kiritish</span>
    
    <div id="expDetails" class="expense-details">
        <div class="category-row">
            <label>Marketing ($)</label>
            <label>Ish haqi ($)</label>
        </div>
        <div class="category-row">
            <input type="number" id="expMark" value="1500">
            <input type="number" id="expSalary" value="3000">
        </div>
        <div class="category-row">
            <label>Boshqa ($)</label>
        </div>
        <input type="number" id="expOther" value="1240" style="width: 100%;">
    </div>

    <button class="update-btn" style="margin-top: 15px;" onclick="calculateAdvancedFinMind()">HISOB-KITOBNI BOSHLASH</button>
</div>

<script>
function calculateAdvancedFinMind() {
    // Ma'lumotlarni yig'ish
    const rev = parseFloat(document.getElementById('inRev').value) || 0;
    const cash = parseFloat(document.getElementById('inCash').value) || 0;
    const mark = parseFloat(document.getElementById('expMark').value) || 0;
    const salary = parseFloat(document.getElementById('expSalary').value) || 0;
    const other = parseFloat(document.getElementById('expOther').value) || 0;
    
    const totalExp = mark + salary + other;
    const netProfit = rev - totalExp;
    const currentBalance = cash + netProfit;
    
    // Burn Rate va Runway (Zaxira qancha vaqtga yetishi)
    const runwayMonths = totalExp > 0 ? (currentBalance / totalExp).toFixed(1) : "∞";
    
    // Dashboardni yangilash
    document.getElementById('totalBal').innerText = '$' + currentBalance.toLocaleString();
    document.getElementById('dispRev').innerText = '+$' + rev.toLocaleString();
    document.getElementById('dispExp').innerText = '-$' + totalExp.toLocaleString();
    
    // AI CFO mantiqi
    let advice = "";
    let healthColor = "var(--success)";
    let healthScore = 0;

    if (totalExp > rev) {
        healthScore = 40;
        healthColor = "var(--danger)";
        advice = `⚠️ <b>AI CFO:</b> Diqqat! Siz zarar ko'ryapsiz. Zaxirangiz ${runwayMonths} oyga yetadi. Marketing xarajatlarini ${Math.round(mark * 0.2)}$ ga kamaytirishni tavsiya qilaman.`;
    } else {
        healthScore = Math.min(Math.round((rev / totalExp) * 30), 100);
        advice = `✅ <b>AI CFO:</b> Foyda barqaror. Zaxirangiz ${runwayMonths} oyga yetadi. Har bir sarflangan $1 marketing uchun sizga $${(rev/mark).toFixed(1)} daromad olib kelyapti.`;
    }

    document.getElementById('healthTag').innerText = `AI: Biznes sog'lig'i (${healthScore}%)`;
    document.getElementById('healthTag').style.color = healthColor;
    document.getElementById('aiCFO').innerHTML = advice;

    // Grafikni yangilash (Simulyatsiya)
    myChart.data.datasets[0].data = [cash-2000, cash-1000, cash, cash+netProfit*0.5, currentBalance];
    myChart.update();
}
</script>
